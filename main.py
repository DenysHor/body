# -*- coding: utf-8 -*-
import datetime as dt
import gspread
from oauth2client.service_account import ServiceAccountCredentials

# ==== НАЛАШТУВАННЯ ====
SERVICE_ACCOUNT_FILE = "gpt-body-parameters-ee1a7fa0b8b5.json"
SHEET_ID = "1iWi6m3o2qatEyDTNXKqkqq_xQ3DacE_E7_NR162GNeI"  # твій файл
# =======================

scope = ["https://spreadsheets.google.com/feeds",
         "https://www.googleapis.com/auth/drive"]
creds = ServiceAccountCredentials.from_json_keyfile_name(SERVICE_ACCOUNT_FILE, scope)
gc = gspread.authorize(creds)
sh = gc.open_by_key(SHEET_ID)

def upsert_worksheet(title, headers, rows):
    """
    Створює аркуш, якщо його немає.
    Якщо є — повністю очищає і заливає дані заново (щоб формат/колонки були коректні).
    """
    try:
        ws = sh.worksheet(title)
    except gspread.exceptions.WorksheetNotFound:
        ws = sh.add_worksheet(title=title, rows=max(100, len(rows) + 10), cols=len(headers))

    # очистити й записати
    ws.clear()
    ws.update([headers] + rows, value_input_option="USER_ENTERED")
    return ws

# ---- Дані «Журнал» (усі заміри) ----
journal_headers = [
    "Дата","Вага (кг)","ІМТ","Тілесний жир (%)","Скелетні м’язи (%)","Вода (%)",
    "Білок (%)","Вісцеральний жир (рівень)","Кісткова маса (%)","BMR (ккал)",
    "Фітнес-вік","Вага жиру (кг)","BFMI","FFM (кг)","Примітки"
]

J = [
    # 21.09.2025 — старт
    ["2025-09-21", 95.9, 29.6, 30.6, 36.8, 50.4, 16.3, 15, 3.6, 1808, 51, 29.4, 7, 66.6, "Стартові дані"],
    # 22.09.2025 — після тренування
    ["2025-09-22", 95.6, 29.5, 29.8, 37.2, 51.0, 16.4, 14, 3.7, 1820, 51, 28.5, 6, 67.1, "Після тренування, другий замір"],
    # 28.09.2025 — ранковий замір
    ["2025-09-28", 95.7, 29.5, 30.7, 36.7, 50.3, 16.4, 15, 3.7, 1802, 51, 29.4, 7, 66.3, "Ранковий замір"],
    # 04.10.2025 — сьогодні
    ["2025-10-04", 96.2, 29.7, 30.0, 37.1, 50.8, 16.3, 14, 3.6, 1824, 51, 28.9, 6, 67.3, "Ранковий замір"],
]

# ---- Дані «Харчування» ----
food_headers = ["Дата","Час","Прийом","Опис страви","Напої","Орієнтовні ккал","Білки (г)","Жири (г)","Вуглеводи (г)","Примітки"]

F = [
    ["2025-09-21","", "Сніданок", "Сніданок (див. фото), перед сніданком — склянка води з лимоном", "Вода з лимоном","","","","","Старт харчового щоденника"],
    ["2025-09-21","", "Перекус",  "Банан після тренування", "", "","","","",""],
    ["2025-09-21","", "Вечеря",   "Теплий салат з індички: перець, салат, помідори, кунжут; соус — оливкова олія, французька гірчиця, винний оцет", "", "","","","",""],
    ["2025-10-04","", "Обід",     "Гречка з цибулею, часником і овочами; м’ясо з овочами та салатом", "Томатний сік", "","","","",""],
]

# ---- Дані «Пульс» ----
pulse_headers = ["Дата","Діапазон (мін–макс, уд/хв)","Останнє вимірювання","Приклад низького","Приклад високого","Середній у спокої","Примітки"]
P = [
    ["2025-09-28","53–91", 62, 59, 89, 57, "Ранковий замір"]
]

if __name__ == "__main__":
    upsert_worksheet("Журнал", journal_headers, J)
    upsert_worksheet("Харчування", food_headers, F)
    upsert_worksheet("Пульс", pulse_headers, P)
    print("Готово: аркуші оновлено.")
